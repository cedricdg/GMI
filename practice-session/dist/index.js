'use strict';

var _draw = require('./lib/draw');

var draw = _interopRequireWildcard(_draw);

var _dataset = require('./lib/dataset');

var _dataset2 = _interopRequireDefault(_dataset);

var _recognizer = require('./lib/recognizer');

var _recognizer2 = _interopRequireDefault(_recognizer);

var _utils = require('./lib/utils');

var utils = _interopRequireWildcard(_utils);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

var letsDraw = false;
var currentGesture = [];
var gestureID = 1;
var trainingMode = true;

var $drawing = document.querySelector('#drawCan');
var $copyDialog = document.querySelector('#copyDialog');
var $boxHeader = document.querySelector('#boxHeader');
var $copyModal = document.querySelector('#copyModal');
var $copyModalText = document.querySelector('#copyModalText');
var $leftSideBar = document.querySelector('#leftSideBar');
var $rightSideBar = document.querySelector('#rightSideBar');
var $input1 = document.querySelector('#inputAgree');
var $input2 = document.querySelector('#inputDisagree');
var $pasteModalPreview = document.querySelector('#pasteModalPreview');
var $selectableText = document.querySelector('#selectableText');

var dataset = new _dataset2.default();
var myRecognizer = new _recognizer2.default();

var MODE_DEFINE_COPY = "define_copy";
var MODE_DEFINE_PASTE = "define_paste";
var MODE_DEFINE_OTHERS = "define_others";

var MODE_DEFINE_GESTURES = "define_gestures";
var MODE_DEFAULT = "default";
var MODE_COPY = "copy";
var MODE_COPIED = "copied";
var MODE_PASTE = "paste";

var currentMode = MODE_DEFINE_GESTURES;

var clipboard = "";
var selection = "";

var changeMode = function changeMode(newMode) {
  console.log("Change mode to: " + newMode);

  switch (newMode) {
    case MODE_DEFAULT:
      hideModal();
      break;
    case MODE_COPY:
      selection = "";
      showModal("Mark text to copy", "#fefefe");
      break;
    case MODE_COPIED:
      showModal("Text copied successfully", "#fefefe");
      break;
    case MODE_PASTE:
      showModal("Select field to paste text", "#fefefe");
      break;
    default:

  }
  currentMode = newMode;
};

function showModal(text, color) {
  console.log($copyModalText);
  $copyModalText.innerText = text;
  $copyModal.style.display = "none";
  $copyModal.style.display = "block";
}

function hideModal() {
  $copyModal.style.display = "none";
}

function mouseDownOnSide(e) {
  e = e || window.event;
  switch (e.which) {
    case 1:
      alert('left');break;
    case 2:
      alert('middle');break;
    case 3:
      alert('right');break;
  }
}

if (typeof window.orientation !== 'undefined') {

  $input1.addEventListener('touchstart', function (e) {
    e.preventDefault();
    clickOnInput($input1);
  });
  $input2.addEventListener('touchstart', function (e) {
    e.preventDefault();
    clickOnInput($input2);
  });

  $rightSideBar.addEventListener('touchstart', function (e) {
    e.preventDefault();
    mouseDownSideBar(e);
  });

  $leftSideBar.addEventListener('touchstart', function (e) {
    e.preventDefault();
    mouseDownSideBar(e);
  });

  // start when mouse is down
  $drawing.addEventListener('touchstart', function (e) {
    e.preventDefault();
    console.log("touchstart");
    mouseDown(e);
  });

  // start when mouse is down
  $drawing.addEventListener('touchmove', function (e) {
    e.preventDefault();
    console.log("touchmove");
    mouseMove(e);
  });

  // start when mouse is down
  $drawing.addEventListener('touchend', function (e) {
    e.preventDefault();
    console.log("touchend");
    mouseUp(e);
  });

  document.addEventListener('touchend', function (e) {
    console.log("Touched text");
    if (currentMode == MODE_COPY && selection != "") {
      console.log("Write to clipboard: ");
      console.log(selection);
      clipboard = selection;
      changeMode(MODE_COPIED);
    }
  });
} else {
  $input1.addEventListener('mousedown', function (e) {
    e.preventDefault();
    clickOnInput($input1);
  });
  $input2.addEventListener('mousedown', function (e) {
    e.preventDefault();
    clickOnInput($input2);
  });

  $rightSideBar.addEventListener('mousedown', function (e) {
    mouseDownSideBar(e);
  });

  $leftSideBar.addEventListener('mousedown', function (e) {
    mouseDownSideBar(e);
  });

  // start when mouse is down
  $drawing.addEventListener('mousedown', function (e) {
    console.log("mousedown");
    mouseDown(e);
  });

  // start when mouse is down
  $drawing.addEventListener('mousemove', function (e) {
    console.log("mousemove");
    mouseMove(e);
  });

  // stop when mouse is up
  $drawing.addEventListener('mouseup', function (e) {
    console.log("mouseup");
    mouseUp(e);
  });

  document.addEventListener('mouseup', function (e) {
    console.log("Touched text");
    if (currentMode == MODE_COPY && selection != "") {
      console.log("Write to clipboard: ");
      console.log(selection);
      clipboard = selection;
      changeMode(MODE_COPIED);
    }
  });
}

var mouseDownSideBar = function mouseDownSideBar(e) {
  $drawing.style.display = "initial";
  mouseDown(e);
};

var clickOnInput = function clickOnInput(inputField) {
  inputField.innerText = clipboard;
  clipboard = "";
  changeMode(MODE_DEFAULT);
};

var mouseDown = function mouseDown(e) {
  var coordinates = draw.getMouseXYinCanvas($drawing, e);
  draw.drawGesture($drawing, 'down', coordinates);
  currentGesture.push(coordinates);
  console.log(coordinates);
  letsDraw = true;
};

var mouseMove = function mouseMove(e) {
  if (letsDraw) {
    var coordinates = draw.getMouseXYinCanvas($drawing, e);
    draw.drawGesture($drawing, 'move', coordinates);
    currentGesture.push(coordinates);
    //console.log(coordinates);
  }
};

var mouseUp = function mouseUp(e) {
  letsDraw = false;

  currentGesture = utils.scale(currentGesture);
  currentGesture = utils.translateToOrigin(currentGesture);
  currentGesture = utils.resample(currentGesture, 30);

  // scale

  if (trainingMode) {
    dataset.addGestureWithLabel(currentGesture, gestureID);
    dataset.plotDatasetInHML();
    gestureID++;
  } else {
    var predictedLabel = myRecognizer.predict(currentGesture);
    console.log(predictedLabel);

    if (predictedLabel === 1) {
      changeMode(MODE_COPY);
    } else if (predictedLabel === 2) {
      if (clipboard !== "") {
        changeMode(MODE_PASTE);
      } else {
        window.alert("Copy text before you paste it");
      }
    } else {}
  }
  $drawing.style.display = "none";
  currentGesture = [];
};

document.addEventListener("selectionchange", function () {
  if (currentMode == MODE_COPY) {
    var selectedText = window.getSelection();
    console.log("Selected Text: " + selectedText.toString());
    selection = selectedText.toString();
  }
});

var $trainingButton = document.querySelector('#trainingButton');
$trainingButton.addEventListener('click', function (e) {
  trainingMode = !trainingMode;
  if (trainingMode) {
    $trainingButton.innerHTML = "Activate Testing";
    $boxHeader.innerHTML = "TRAINING MODE";
  } else {
    myRecognizer.fit(dataset);
    $trainingButton.innerHTML = "Activate Training";
    $boxHeader.innerHTML = "TESTING MODE";
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImRyYXciLCJ1dGlscyIsImxldHNEcmF3IiwiY3VycmVudEdlc3R1cmUiLCJnZXN0dXJlSUQiLCJ0cmFpbmluZ01vZGUiLCIkZHJhd2luZyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIiRjb3B5RGlhbG9nIiwiJGJveEhlYWRlciIsIiRjb3B5TW9kYWwiLCIkY29weU1vZGFsVGV4dCIsIiRsZWZ0U2lkZUJhciIsIiRyaWdodFNpZGVCYXIiLCIkaW5wdXQxIiwiJGlucHV0MiIsIiRwYXN0ZU1vZGFsUHJldmlldyIsIiRzZWxlY3RhYmxlVGV4dCIsImRhdGFzZXQiLCJteVJlY29nbml6ZXIiLCJNT0RFX0RFRklORV9DT1BZIiwiTU9ERV9ERUZJTkVfUEFTVEUiLCJNT0RFX0RFRklORV9PVEhFUlMiLCJNT0RFX0RFRklORV9HRVNUVVJFUyIsIk1PREVfREVGQVVMVCIsIk1PREVfQ09QWSIsIk1PREVfQ09QSUVEIiwiTU9ERV9QQVNURSIsImN1cnJlbnRNb2RlIiwiY2xpcGJvYXJkIiwic2VsZWN0aW9uIiwiY2hhbmdlTW9kZSIsIm5ld01vZGUiLCJjb25zb2xlIiwibG9nIiwiaGlkZU1vZGFsIiwic2hvd01vZGFsIiwidGV4dCIsImNvbG9yIiwiaW5uZXJUZXh0Iiwic3R5bGUiLCJkaXNwbGF5IiwibW91c2VEb3duT25TaWRlIiwiZSIsIndpbmRvdyIsImV2ZW50Iiwid2hpY2giLCJhbGVydCIsIm9yaWVudGF0aW9uIiwiYWRkRXZlbnRMaXN0ZW5lciIsInByZXZlbnREZWZhdWx0IiwiY2xpY2tPbklucHV0IiwibW91c2VEb3duU2lkZUJhciIsIm1vdXNlRG93biIsIm1vdXNlTW92ZSIsIm1vdXNlVXAiLCJpbnB1dEZpZWxkIiwiY29vcmRpbmF0ZXMiLCJnZXRNb3VzZVhZaW5DYW52YXMiLCJkcmF3R2VzdHVyZSIsInB1c2giLCJzY2FsZSIsInRyYW5zbGF0ZVRvT3JpZ2luIiwicmVzYW1wbGUiLCJhZGRHZXN0dXJlV2l0aExhYmVsIiwicGxvdERhdGFzZXRJbkhNTCIsInByZWRpY3RlZExhYmVsIiwicHJlZGljdCIsInNlbGVjdGVkVGV4dCIsImdldFNlbGVjdGlvbiIsInRvU3RyaW5nIiwiJHRyYWluaW5nQnV0dG9uIiwiaW5uZXJIVE1MIiwiZml0Il0sIm1hcHBpbmdzIjoiOztBQUFBOztJQUFZQSxJOztBQUNaOzs7O0FBQ0E7Ozs7QUFDQTs7SUFBWUMsSzs7Ozs7O0FBRVosSUFBSUMsV0FBVyxLQUFmO0FBQ0EsSUFBSUMsaUJBQWlCLEVBQXJCO0FBQ0EsSUFBSUMsWUFBWSxDQUFoQjtBQUNBLElBQUlDLGVBQWUsSUFBbkI7O0FBRUEsSUFBTUMsV0FBV0MsU0FBU0MsYUFBVCxDQUF1QixVQUF2QixDQUFqQjtBQUNBLElBQU1DLGNBQWNGLFNBQVNDLGFBQVQsQ0FBdUIsYUFBdkIsQ0FBcEI7QUFDQSxJQUFNRSxhQUFhSCxTQUFTQyxhQUFULENBQXVCLFlBQXZCLENBQW5CO0FBQ0EsSUFBTUcsYUFBYUosU0FBU0MsYUFBVCxDQUF1QixZQUF2QixDQUFuQjtBQUNBLElBQU1JLGlCQUFpQkwsU0FBU0MsYUFBVCxDQUF1QixnQkFBdkIsQ0FBdkI7QUFDQSxJQUFNSyxlQUFlTixTQUFTQyxhQUFULENBQXVCLGNBQXZCLENBQXJCO0FBQ0EsSUFBTU0sZ0JBQWdCUCxTQUFTQyxhQUFULENBQXVCLGVBQXZCLENBQXRCO0FBQ0EsSUFBTU8sVUFBVVIsU0FBU0MsYUFBVCxDQUF1QixhQUF2QixDQUFoQjtBQUNBLElBQU1RLFVBQVVULFNBQVNDLGFBQVQsQ0FBdUIsZ0JBQXZCLENBQWhCO0FBQ0EsSUFBTVMscUJBQXFCVixTQUFTQyxhQUFULENBQXVCLG9CQUF2QixDQUEzQjtBQUNBLElBQU1VLGtCQUFrQlgsU0FBU0MsYUFBVCxDQUF1QixpQkFBdkIsQ0FBeEI7O0FBRUEsSUFBSVcsVUFBVSx1QkFBZDtBQUNBLElBQUlDLGVBQWUsMEJBQW5COztBQUVBLElBQU1DLG1CQUFtQixhQUF6QjtBQUNBLElBQU1DLG9CQUFvQixjQUExQjtBQUNBLElBQU1DLHFCQUFxQixlQUEzQjs7QUFFQSxJQUFNQyx1QkFBdUIsaUJBQTdCO0FBQ0EsSUFBTUMsZUFBZSxTQUFyQjtBQUNBLElBQU1DLFlBQVksTUFBbEI7QUFDQSxJQUFNQyxjQUFjLFFBQXBCO0FBQ0EsSUFBTUMsYUFBYSxPQUFuQjs7QUFFQSxJQUFJQyxjQUFjTCxvQkFBbEI7O0FBRUEsSUFBSU0sWUFBWSxFQUFoQjtBQUNBLElBQUlDLFlBQVksRUFBaEI7O0FBRUEsSUFBSUMsYUFBYSxTQUFiQSxVQUFhLENBQVNDLE9BQVQsRUFDakI7QUFDRUMsVUFBUUMsR0FBUixDQUFZLHFCQUFxQkYsT0FBakM7O0FBRUEsVUFBUUEsT0FBUjtBQUNFLFNBQUtSLFlBQUw7QUFDRVc7QUFDQTtBQUNGLFNBQUtWLFNBQUw7QUFDRUssa0JBQVksRUFBWjtBQUNBTSxnQkFBVSxtQkFBVixFQUErQixTQUEvQjtBQUNBO0FBQ0YsU0FBS1YsV0FBTDtBQUNFVSxnQkFBVSwwQkFBVixFQUFzQyxTQUF0QztBQUNBO0FBQ0YsU0FBS1QsVUFBTDtBQUNFUyxnQkFBVSw0QkFBVixFQUF3QyxTQUF4QztBQUNBO0FBQ0Y7O0FBZEY7QUFpQkFSLGdCQUFjSSxPQUFkO0FBQ0QsQ0F0QkQ7O0FBd0JBLFNBQVNJLFNBQVQsQ0FBbUJDLElBQW5CLEVBQXlCQyxLQUF6QixFQUErQjtBQUM3QkwsVUFBUUMsR0FBUixDQUFZdkIsY0FBWjtBQUNBQSxpQkFBZTRCLFNBQWYsR0FBMkJGLElBQTNCO0FBQ0EzQixhQUFXOEIsS0FBWCxDQUFpQkMsT0FBakIsR0FBMkIsTUFBM0I7QUFDQS9CLGFBQVc4QixLQUFYLENBQWlCQyxPQUFqQixHQUEyQixPQUEzQjtBQUNEOztBQUVELFNBQVNOLFNBQVQsR0FBb0I7QUFDbEJ6QixhQUFXOEIsS0FBWCxDQUFpQkMsT0FBakIsR0FBMkIsTUFBM0I7QUFDRDs7QUFHRCxTQUFTQyxlQUFULENBQXlCQyxDQUF6QixFQUE0QjtBQUMxQkEsTUFBSUEsS0FBS0MsT0FBT0MsS0FBaEI7QUFDQSxVQUFRRixFQUFFRyxLQUFWO0FBQ0UsU0FBSyxDQUFMO0FBQVFDLFlBQU0sTUFBTixFQUFlO0FBQ3ZCLFNBQUssQ0FBTDtBQUFRQSxZQUFNLFFBQU4sRUFBaUI7QUFDekIsU0FBSyxDQUFMO0FBQVFBLFlBQU0sT0FBTixFQUFnQjtBQUgxQjtBQUtEOztBQUVELElBQUksT0FBT0gsT0FBT0ksV0FBZCxLQUE4QixXQUFsQyxFQUErQzs7QUFFN0NsQyxVQUFRbUMsZ0JBQVIsQ0FBeUIsWUFBekIsRUFBdUMsVUFBU04sQ0FBVCxFQUFXO0FBQ2hEQSxNQUFFTyxjQUFGO0FBQ0FDLGlCQUFhckMsT0FBYjtBQUNELEdBSEQ7QUFJQUMsVUFBUWtDLGdCQUFSLENBQXlCLFlBQXpCLEVBQXVDLFVBQVNOLENBQVQsRUFBVztBQUNoREEsTUFBRU8sY0FBRjtBQUNBQyxpQkFBYXBDLE9BQWI7QUFDRCxHQUhEOztBQUtBRixnQkFBY29DLGdCQUFkLENBQStCLFlBQS9CLEVBQTZDLFVBQVNOLENBQVQsRUFBVztBQUN0REEsTUFBRU8sY0FBRjtBQUNBRSxxQkFBaUJULENBQWpCO0FBQ0QsR0FIRDs7QUFLQS9CLGVBQWFxQyxnQkFBYixDQUE4QixZQUE5QixFQUE0QyxVQUFTTixDQUFULEVBQVc7QUFDckRBLE1BQUVPLGNBQUY7QUFDQUUscUJBQWlCVCxDQUFqQjtBQUNELEdBSEQ7O0FBS0E7QUFDQXRDLFdBQVM0QyxnQkFBVCxDQUEwQixZQUExQixFQUF3QyxVQUFTTixDQUFULEVBQVk7QUFDbERBLE1BQUVPLGNBQUY7QUFDQWpCLFlBQVFDLEdBQVIsQ0FBWSxZQUFaO0FBQ0FtQixjQUFVVixDQUFWO0FBQ0QsR0FKRDs7QUFNQTtBQUNBdEMsV0FBUzRDLGdCQUFULENBQTBCLFdBQTFCLEVBQXVDLFVBQVNOLENBQVQsRUFBWTtBQUNqREEsTUFBRU8sY0FBRjtBQUNBakIsWUFBUUMsR0FBUixDQUFZLFdBQVo7QUFDQW9CLGNBQVVYLENBQVY7QUFDRCxHQUpEOztBQU1BO0FBQ0F0QyxXQUFTNEMsZ0JBQVQsQ0FBMEIsVUFBMUIsRUFBc0MsVUFBU04sQ0FBVCxFQUFZO0FBQ2hEQSxNQUFFTyxjQUFGO0FBQ0FqQixZQUFRQyxHQUFSLENBQVksVUFBWjtBQUNBcUIsWUFBUVosQ0FBUjtBQUNELEdBSkQ7O0FBTUFyQyxXQUFTMkMsZ0JBQVQsQ0FBMEIsVUFBMUIsRUFBc0MsVUFBU04sQ0FBVCxFQUFZO0FBQ2hEVixZQUFRQyxHQUFSLENBQVksY0FBWjtBQUNBLFFBQUdOLGVBQWVILFNBQWYsSUFBNEJLLGFBQWEsRUFBNUMsRUFBK0M7QUFDN0NHLGNBQVFDLEdBQVIsQ0FBWSxzQkFBWjtBQUNBRCxjQUFRQyxHQUFSLENBQVlKLFNBQVo7QUFDQUQsa0JBQVlDLFNBQVo7QUFDQUMsaUJBQVdMLFdBQVg7QUFDRDtBQUNGLEdBUkQ7QUFVRCxDQXBERCxNQW9ETztBQUNMWixVQUFRbUMsZ0JBQVIsQ0FBeUIsV0FBekIsRUFBc0MsVUFBU04sQ0FBVCxFQUFXO0FBQy9DQSxNQUFFTyxjQUFGO0FBQ0FDLGlCQUFhckMsT0FBYjtBQUNELEdBSEQ7QUFJQUMsVUFBUWtDLGdCQUFSLENBQXlCLFdBQXpCLEVBQXNDLFVBQVNOLENBQVQsRUFBVztBQUMvQ0EsTUFBRU8sY0FBRjtBQUNBQyxpQkFBYXBDLE9BQWI7QUFDRCxHQUhEOztBQUtBRixnQkFBY29DLGdCQUFkLENBQStCLFdBQS9CLEVBQTRDLFVBQVNOLENBQVQsRUFBVztBQUNyRFMscUJBQWlCVCxDQUFqQjtBQUNELEdBRkQ7O0FBSUEvQixlQUFhcUMsZ0JBQWIsQ0FBOEIsV0FBOUIsRUFBMkMsVUFBU04sQ0FBVCxFQUFXO0FBQ3BEUyxxQkFBaUJULENBQWpCO0FBQ0QsR0FGRDs7QUFJQTtBQUNBdEMsV0FBUzRDLGdCQUFULENBQTBCLFdBQTFCLEVBQXVDLFVBQVNOLENBQVQsRUFBWTtBQUNqRFYsWUFBUUMsR0FBUixDQUFZLFdBQVo7QUFDQW1CLGNBQVVWLENBQVY7QUFDRCxHQUhEOztBQUtBO0FBQ0F0QyxXQUFTNEMsZ0JBQVQsQ0FBMEIsV0FBMUIsRUFBdUMsVUFBU04sQ0FBVCxFQUFZO0FBQ2pEVixZQUFRQyxHQUFSLENBQVksV0FBWjtBQUNBb0IsY0FBVVgsQ0FBVjtBQUNELEdBSEQ7O0FBS0E7QUFDQXRDLFdBQVM0QyxnQkFBVCxDQUEwQixTQUExQixFQUFxQyxVQUFTTixDQUFULEVBQVk7QUFDL0NWLFlBQVFDLEdBQVIsQ0FBWSxTQUFaO0FBQ0FxQixZQUFRWixDQUFSO0FBQ0QsR0FIRDs7QUFLQXJDLFdBQVMyQyxnQkFBVCxDQUEwQixTQUExQixFQUFxQyxVQUFTTixDQUFULEVBQVk7QUFDL0NWLFlBQVFDLEdBQVIsQ0FBWSxjQUFaO0FBQ0EsUUFBR04sZUFBZUgsU0FBZixJQUE0QkssYUFBYSxFQUE1QyxFQUErQztBQUM3Q0csY0FBUUMsR0FBUixDQUFZLHNCQUFaO0FBQ0FELGNBQVFDLEdBQVIsQ0FBWUosU0FBWjtBQUNBRCxrQkFBWUMsU0FBWjtBQUNBQyxpQkFBV0wsV0FBWDtBQUNEO0FBQ0YsR0FSRDtBQVNEOztBQUVELElBQU0wQixtQkFBbUIsU0FBbkJBLGdCQUFtQixDQUFTVCxDQUFULEVBQVc7QUFDbEN0QyxXQUFTbUMsS0FBVCxDQUFlQyxPQUFmLEdBQXlCLFNBQXpCO0FBQ0FZLFlBQVVWLENBQVY7QUFDRCxDQUhEOztBQUtBLElBQU1RLGVBQWUsU0FBZkEsWUFBZSxDQUFTSyxVQUFULEVBQW9CO0FBQ3ZDQSxhQUFXakIsU0FBWCxHQUF1QlYsU0FBdkI7QUFDQUEsY0FBWSxFQUFaO0FBQ0FFLGFBQVdQLFlBQVg7QUFDRCxDQUpEOztBQU1BLElBQU02QixZQUFZLFNBQVpBLFNBQVksQ0FBU1YsQ0FBVCxFQUFZO0FBQzVCLE1BQU1jLGNBQWMxRCxLQUFLMkQsa0JBQUwsQ0FBd0JyRCxRQUF4QixFQUFrQ3NDLENBQWxDLENBQXBCO0FBQ0E1QyxPQUFLNEQsV0FBTCxDQUFpQnRELFFBQWpCLEVBQTJCLE1BQTNCLEVBQW1Db0QsV0FBbkM7QUFDQXZELGlCQUFlMEQsSUFBZixDQUFvQkgsV0FBcEI7QUFDQXhCLFVBQVFDLEdBQVIsQ0FBWXVCLFdBQVo7QUFDQXhELGFBQVcsSUFBWDtBQUNELENBTkQ7O0FBUUEsSUFBTXFELFlBQVksU0FBWkEsU0FBWSxDQUFTWCxDQUFULEVBQVk7QUFDNUIsTUFBSTFDLFFBQUosRUFBYztBQUNaLFFBQU13RCxjQUFjMUQsS0FBSzJELGtCQUFMLENBQXdCckQsUUFBeEIsRUFBa0NzQyxDQUFsQyxDQUFwQjtBQUNBNUMsU0FBSzRELFdBQUwsQ0FBaUJ0RCxRQUFqQixFQUEyQixNQUEzQixFQUFtQ29ELFdBQW5DO0FBQ0F2RCxtQkFBZTBELElBQWYsQ0FBb0JILFdBQXBCO0FBQ0E7QUFDRDtBQUNGLENBUEQ7O0FBU0EsSUFBTUYsVUFBVSxTQUFWQSxPQUFVLENBQVNaLENBQVQsRUFBWTtBQUMxQjFDLGFBQVcsS0FBWDs7QUFFQUMsbUJBQWlCRixNQUFNNkQsS0FBTixDQUFZM0QsY0FBWixDQUFqQjtBQUNBQSxtQkFBaUJGLE1BQU04RCxpQkFBTixDQUF3QjVELGNBQXhCLENBQWpCO0FBQ0FBLG1CQUFpQkYsTUFBTStELFFBQU4sQ0FBZTdELGNBQWYsRUFBK0IsRUFBL0IsQ0FBakI7O0FBRUE7O0FBRUEsTUFBSUUsWUFBSixFQUFrQjtBQUNoQmMsWUFBUThDLG1CQUFSLENBQTRCOUQsY0FBNUIsRUFBNENDLFNBQTVDO0FBQ0FlLFlBQVErQyxnQkFBUjtBQUNBOUQ7QUFDRCxHQUpELE1BSU87QUFDTCxRQUFNK0QsaUJBQWlCL0MsYUFBYWdELE9BQWIsQ0FBcUJqRSxjQUFyQixDQUF2QjtBQUNBK0IsWUFBUUMsR0FBUixDQUFZZ0MsY0FBWjs7QUFFQSxRQUFJQSxtQkFBbUIsQ0FBdkIsRUFBMEI7QUFDeEJuQyxpQkFBV04sU0FBWDtBQUNELEtBRkQsTUFFTyxJQUFJeUMsbUJBQW1CLENBQXZCLEVBQTBCO0FBQy9CLFVBQUdyQyxjQUFjLEVBQWpCLEVBQW9CO0FBQ2xCRSxtQkFBV0osVUFBWDtBQUNELE9BRkQsTUFFTztBQUNMaUIsZUFBT0csS0FBUCxDQUFhLCtCQUFiO0FBQ0Q7QUFDRixLQU5NLE1BTUEsQ0FFTjtBQUNGO0FBQ0QxQyxXQUFTbUMsS0FBVCxDQUFlQyxPQUFmLEdBQXlCLE1BQXpCO0FBQ0F2QyxtQkFBaUIsRUFBakI7QUFDRCxDQS9CRDs7QUFpQ0FJLFNBQVMyQyxnQkFBVCxDQUEwQixpQkFBMUIsRUFBNkMsWUFBVztBQUN0RCxNQUFHckIsZUFBZUgsU0FBbEIsRUFBNEI7QUFDMUIsUUFBSTJDLGVBQWV4QixPQUFPeUIsWUFBUCxFQUFuQjtBQUNBcEMsWUFBUUMsR0FBUixDQUFZLG9CQUFvQmtDLGFBQWFFLFFBQWIsRUFBaEM7QUFDQXhDLGdCQUFZc0MsYUFBYUUsUUFBYixFQUFaO0FBQ0Q7QUFDRixDQU5EOztBQVFBLElBQU1DLGtCQUFrQmpFLFNBQVNDLGFBQVQsQ0FBdUIsaUJBQXZCLENBQXhCO0FBQ0FnRSxnQkFBZ0J0QixnQkFBaEIsQ0FBaUMsT0FBakMsRUFBMEMsVUFBU04sQ0FBVCxFQUFZO0FBQ3BEdkMsaUJBQWUsQ0FBQ0EsWUFBaEI7QUFDQSxNQUFJQSxZQUFKLEVBQWtCO0FBQ2hCbUUsb0JBQWdCQyxTQUFoQixHQUE0QixrQkFBNUI7QUFDQS9ELGVBQVcrRCxTQUFYLEdBQXVCLGVBQXZCO0FBQ0QsR0FIRCxNQUdPO0FBQ0xyRCxpQkFBYXNELEdBQWIsQ0FBaUJ2RCxPQUFqQjtBQUNBcUQsb0JBQWdCQyxTQUFoQixHQUE0QixtQkFBNUI7QUFDQS9ELGVBQVcrRCxTQUFYLEdBQXVCLGNBQXZCO0FBQ0Q7QUFDRixDQVZEIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZHJhdyBmcm9tICcuL2xpYi9kcmF3J1xuaW1wb3J0IERhdGFzZXQgZnJvbSAnLi9saWIvZGF0YXNldCdcbmltcG9ydCBSZWNvZ25pemVyIGZyb20gJy4vbGliL3JlY29nbml6ZXInXG5pbXBvcnQgKiBhcyB1dGlscyBmcm9tICcuL2xpYi91dGlscydcblxubGV0IGxldHNEcmF3ID0gZmFsc2U7XG5sZXQgY3VycmVudEdlc3R1cmUgPSBbXTtcbmxldCBnZXN0dXJlSUQgPSAxO1xubGV0IHRyYWluaW5nTW9kZSA9IHRydWU7XG5cbmNvbnN0ICRkcmF3aW5nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2RyYXdDYW4nKTtcbmNvbnN0ICRjb3B5RGlhbG9nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2NvcHlEaWFsb2cnKTtcbmNvbnN0ICRib3hIZWFkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjYm94SGVhZGVyJyk7XG5jb25zdCAkY29weU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2NvcHlNb2RhbCcpO1xuY29uc3QgJGNvcHlNb2RhbFRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY29weU1vZGFsVGV4dCcpO1xuY29uc3QgJGxlZnRTaWRlQmFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2xlZnRTaWRlQmFyJyk7XG5jb25zdCAkcmlnaHRTaWRlQmFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3JpZ2h0U2lkZUJhcicpO1xuY29uc3QgJGlucHV0MSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNpbnB1dEFncmVlJyk7XG5jb25zdCAkaW5wdXQyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2lucHV0RGlzYWdyZWUnKTtcbmNvbnN0ICRwYXN0ZU1vZGFsUHJldmlldyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwYXN0ZU1vZGFsUHJldmlldycpO1xuY29uc3QgJHNlbGVjdGFibGVUZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3NlbGVjdGFibGVUZXh0Jyk7XG5cbmxldCBkYXRhc2V0ID0gbmV3IERhdGFzZXQoKTtcbmxldCBteVJlY29nbml6ZXIgPSBuZXcgUmVjb2duaXplcigpO1xuXG5jb25zdCBNT0RFX0RFRklORV9DT1BZID0gXCJkZWZpbmVfY29weVwiO1xuY29uc3QgTU9ERV9ERUZJTkVfUEFTVEUgPSBcImRlZmluZV9wYXN0ZVwiO1xuY29uc3QgTU9ERV9ERUZJTkVfT1RIRVJTID0gXCJkZWZpbmVfb3RoZXJzXCI7XG5cbmNvbnN0IE1PREVfREVGSU5FX0dFU1RVUkVTID0gXCJkZWZpbmVfZ2VzdHVyZXNcIjtcbmNvbnN0IE1PREVfREVGQVVMVCA9IFwiZGVmYXVsdFwiO1xuY29uc3QgTU9ERV9DT1BZID0gXCJjb3B5XCI7XG5jb25zdCBNT0RFX0NPUElFRCA9IFwiY29waWVkXCI7XG5jb25zdCBNT0RFX1BBU1RFID0gXCJwYXN0ZVwiO1xuXG5sZXQgY3VycmVudE1vZGUgPSBNT0RFX0RFRklORV9HRVNUVVJFUztcblxudmFyIGNsaXBib2FyZCA9IFwiXCI7XG52YXIgc2VsZWN0aW9uID0gXCJcIjtcblxudmFyIGNoYW5nZU1vZGUgPSBmdW5jdGlvbihuZXdNb2RlKVxue1xuICBjb25zb2xlLmxvZyhcIkNoYW5nZSBtb2RlIHRvOiBcIiArIG5ld01vZGUpO1xuXG4gIHN3aXRjaCAobmV3TW9kZSkge1xuICAgIGNhc2UgTU9ERV9ERUZBVUxUOlxuICAgICAgaGlkZU1vZGFsKCk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIE1PREVfQ09QWTpcbiAgICAgIHNlbGVjdGlvbiA9IFwiXCI7XG4gICAgICBzaG93TW9kYWwoXCJNYXJrIHRleHQgdG8gY29weVwiLCBcIiNmZWZlZmVcIik7XG4gICAgICBicmVhaztcbiAgICBjYXNlIE1PREVfQ09QSUVEOlxuICAgICAgc2hvd01vZGFsKFwiVGV4dCBjb3BpZWQgc3VjY2Vzc2Z1bGx5XCIsIFwiI2ZlZmVmZVwiKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgTU9ERV9QQVNURTpcbiAgICAgIHNob3dNb2RhbChcIlNlbGVjdCBmaWVsZCB0byBwYXN0ZSB0ZXh0XCIsIFwiI2ZlZmVmZVwiKTtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG5cbiAgfVxuICBjdXJyZW50TW9kZSA9IG5ld01vZGU7XG59XG5cbmZ1bmN0aW9uIHNob3dNb2RhbCh0ZXh0LCBjb2xvcil7XG4gIGNvbnNvbGUubG9nKCRjb3B5TW9kYWxUZXh0KTtcbiAgJGNvcHlNb2RhbFRleHQuaW5uZXJUZXh0ID0gdGV4dDtcbiAgJGNvcHlNb2RhbC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICRjb3B5TW9kYWwuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbn1cblxuZnVuY3Rpb24gaGlkZU1vZGFsKCl7XG4gICRjb3B5TW9kYWwuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xufVxuXG5cbmZ1bmN0aW9uIG1vdXNlRG93bk9uU2lkZShlKSB7XG4gIGUgPSBlIHx8IHdpbmRvdy5ldmVudDtcbiAgc3dpdGNoIChlLndoaWNoKSB7XG4gICAgY2FzZSAxOiBhbGVydCgnbGVmdCcpOyBicmVhaztcbiAgICBjYXNlIDI6IGFsZXJ0KCdtaWRkbGUnKTsgYnJlYWs7XG4gICAgY2FzZSAzOiBhbGVydCgncmlnaHQnKTsgYnJlYWs7XG4gIH1cbn1cblxuaWYgKHR5cGVvZiB3aW5kb3cub3JpZW50YXRpb24gIT09ICd1bmRlZmluZWQnKSB7XG5cbiAgJGlucHV0MS5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgZnVuY3Rpb24oZSl7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNsaWNrT25JbnB1dCgkaW5wdXQxKTtcbiAgfSk7XG4gICRpbnB1dDIuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIGZ1bmN0aW9uKGUpe1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjbGlja09uSW5wdXQoJGlucHV0Mik7XG4gIH0pO1xuXG4gICRyaWdodFNpZGVCYXIuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIGZ1bmN0aW9uKGUpe1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBtb3VzZURvd25TaWRlQmFyKGUpO1xuICB9KTtcblxuICAkbGVmdFNpZGVCYXIuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIGZ1bmN0aW9uKGUpe1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBtb3VzZURvd25TaWRlQmFyKGUpO1xuICB9KTtcblxuICAvLyBzdGFydCB3aGVuIG1vdXNlIGlzIGRvd25cbiAgJGRyYXdpbmcuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIGZ1bmN0aW9uKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc29sZS5sb2coXCJ0b3VjaHN0YXJ0XCIpO1xuICAgIG1vdXNlRG93bihlKTtcbiAgfSk7XG5cbiAgLy8gc3RhcnQgd2hlbiBtb3VzZSBpcyBkb3duXG4gICRkcmF3aW5nLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIGZ1bmN0aW9uKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc29sZS5sb2coXCJ0b3VjaG1vdmVcIik7XG4gICAgbW91c2VNb3ZlKGUpO1xuICB9KTtcblxuICAvLyBzdGFydCB3aGVuIG1vdXNlIGlzIGRvd25cbiAgJGRyYXdpbmcuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBmdW5jdGlvbihlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnNvbGUubG9nKFwidG91Y2hlbmRcIik7XG4gICAgbW91c2VVcChlKTtcbiAgfSk7XG5cbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBmdW5jdGlvbihlKSB7XG4gICAgY29uc29sZS5sb2coXCJUb3VjaGVkIHRleHRcIik7XG4gICAgaWYoY3VycmVudE1vZGUgPT0gTU9ERV9DT1BZICYmIHNlbGVjdGlvbiAhPSBcIlwiKXtcbiAgICAgIGNvbnNvbGUubG9nKFwiV3JpdGUgdG8gY2xpcGJvYXJkOiBcIik7XG4gICAgICBjb25zb2xlLmxvZyhzZWxlY3Rpb24pO1xuICAgICAgY2xpcGJvYXJkID0gc2VsZWN0aW9uO1xuICAgICAgY2hhbmdlTW9kZShNT0RFX0NPUElFRCk7XG4gICAgfVxuICB9KVxuXG59IGVsc2Uge1xuICAkaW5wdXQxLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGZ1bmN0aW9uKGUpe1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjbGlja09uSW5wdXQoJGlucHV0MSk7XG4gIH0pO1xuICAkaW5wdXQyLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGZ1bmN0aW9uKGUpe1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjbGlja09uSW5wdXQoJGlucHV0Mik7XG4gIH0pO1xuXG4gICRyaWdodFNpZGVCYXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgZnVuY3Rpb24oZSl7XG4gICAgbW91c2VEb3duU2lkZUJhcihlKTtcbiAgfSk7XG5cbiAgJGxlZnRTaWRlQmFyLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGZ1bmN0aW9uKGUpe1xuICAgIG1vdXNlRG93blNpZGVCYXIoZSk7XG4gIH0pO1xuXG4gIC8vIHN0YXJ0IHdoZW4gbW91c2UgaXMgZG93blxuICAkZHJhd2luZy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBmdW5jdGlvbihlKSB7XG4gICAgY29uc29sZS5sb2coXCJtb3VzZWRvd25cIik7XG4gICAgbW91c2VEb3duKGUpO1xuICB9KTtcblxuICAvLyBzdGFydCB3aGVuIG1vdXNlIGlzIGRvd25cbiAgJGRyYXdpbmcuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgZnVuY3Rpb24oZSkge1xuICAgIGNvbnNvbGUubG9nKFwibW91c2Vtb3ZlXCIpO1xuICAgIG1vdXNlTW92ZShlKTtcbiAgfSk7XG5cbiAgLy8gc3RvcCB3aGVuIG1vdXNlIGlzIHVwXG4gICRkcmF3aW5nLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBmdW5jdGlvbihlKSB7XG4gICAgY29uc29sZS5sb2coXCJtb3VzZXVwXCIpO1xuICAgIG1vdXNlVXAoZSk7XG4gIH0pO1xuXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBmdW5jdGlvbihlKSB7XG4gICAgY29uc29sZS5sb2coXCJUb3VjaGVkIHRleHRcIik7XG4gICAgaWYoY3VycmVudE1vZGUgPT0gTU9ERV9DT1BZICYmIHNlbGVjdGlvbiAhPSBcIlwiKXtcbiAgICAgIGNvbnNvbGUubG9nKFwiV3JpdGUgdG8gY2xpcGJvYXJkOiBcIik7XG4gICAgICBjb25zb2xlLmxvZyhzZWxlY3Rpb24pO1xuICAgICAgY2xpcGJvYXJkID0gc2VsZWN0aW9uO1xuICAgICAgY2hhbmdlTW9kZShNT0RFX0NPUElFRCk7XG4gICAgfVxuICB9KVxufVxuXG5jb25zdCBtb3VzZURvd25TaWRlQmFyID0gZnVuY3Rpb24oZSl7XG4gICRkcmF3aW5nLnN0eWxlLmRpc3BsYXkgPSBcImluaXRpYWxcIjtcbiAgbW91c2VEb3duKGUpO1xufTtcblxuY29uc3QgY2xpY2tPbklucHV0ID0gZnVuY3Rpb24oaW5wdXRGaWVsZCl7XG4gIGlucHV0RmllbGQuaW5uZXJUZXh0ID0gY2xpcGJvYXJkO1xuICBjbGlwYm9hcmQgPSBcIlwiO1xuICBjaGFuZ2VNb2RlKE1PREVfREVGQVVMVCk7XG59XG5cbmNvbnN0IG1vdXNlRG93biA9IGZ1bmN0aW9uKGUpIHtcbiAgY29uc3QgY29vcmRpbmF0ZXMgPSBkcmF3LmdldE1vdXNlWFlpbkNhbnZhcygkZHJhd2luZywgZSk7XG4gIGRyYXcuZHJhd0dlc3R1cmUoJGRyYXdpbmcsICdkb3duJywgY29vcmRpbmF0ZXMpO1xuICBjdXJyZW50R2VzdHVyZS5wdXNoKGNvb3JkaW5hdGVzKTtcbiAgY29uc29sZS5sb2coY29vcmRpbmF0ZXMpO1xuICBsZXRzRHJhdyA9IHRydWU7XG59O1xuXG5jb25zdCBtb3VzZU1vdmUgPSBmdW5jdGlvbihlKSB7XG4gIGlmIChsZXRzRHJhdykge1xuICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gZHJhdy5nZXRNb3VzZVhZaW5DYW52YXMoJGRyYXdpbmcsIGUpO1xuICAgIGRyYXcuZHJhd0dlc3R1cmUoJGRyYXdpbmcsICdtb3ZlJywgY29vcmRpbmF0ZXMpO1xuICAgIGN1cnJlbnRHZXN0dXJlLnB1c2goY29vcmRpbmF0ZXMpO1xuICAgIC8vY29uc29sZS5sb2coY29vcmRpbmF0ZXMpO1xuICB9XG59O1xuXG5jb25zdCBtb3VzZVVwID0gZnVuY3Rpb24oZSkge1xuICBsZXRzRHJhdyA9IGZhbHNlO1xuXG4gIGN1cnJlbnRHZXN0dXJlID0gdXRpbHMuc2NhbGUoY3VycmVudEdlc3R1cmUpO1xuICBjdXJyZW50R2VzdHVyZSA9IHV0aWxzLnRyYW5zbGF0ZVRvT3JpZ2luKGN1cnJlbnRHZXN0dXJlKTtcbiAgY3VycmVudEdlc3R1cmUgPSB1dGlscy5yZXNhbXBsZShjdXJyZW50R2VzdHVyZSwgMzApO1xuXG4gIC8vIHNjYWxlXG5cbiAgaWYgKHRyYWluaW5nTW9kZSkge1xuICAgIGRhdGFzZXQuYWRkR2VzdHVyZVdpdGhMYWJlbChjdXJyZW50R2VzdHVyZSwgZ2VzdHVyZUlEKTtcbiAgICBkYXRhc2V0LnBsb3REYXRhc2V0SW5ITUwoKTtcbiAgICBnZXN0dXJlSUQrKztcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBwcmVkaWN0ZWRMYWJlbCA9IG15UmVjb2duaXplci5wcmVkaWN0KGN1cnJlbnRHZXN0dXJlKTtcbiAgICBjb25zb2xlLmxvZyhwcmVkaWN0ZWRMYWJlbCk7XG5cbiAgICBpZiAocHJlZGljdGVkTGFiZWwgPT09IDEpIHtcbiAgICAgIGNoYW5nZU1vZGUoTU9ERV9DT1BZKTtcbiAgICB9IGVsc2UgaWYgKHByZWRpY3RlZExhYmVsID09PSAyKSB7XG4gICAgICBpZihjbGlwYm9hcmQgIT09IFwiXCIpe1xuICAgICAgICBjaGFuZ2VNb2RlKE1PREVfUEFTVEUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd2luZG93LmFsZXJ0KFwiQ29weSB0ZXh0IGJlZm9yZSB5b3UgcGFzdGUgaXRcIik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcblxuICAgIH1cbiAgfVxuICAkZHJhd2luZy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gIGN1cnJlbnRHZXN0dXJlID0gW107XG59O1xuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwic2VsZWN0aW9uY2hhbmdlXCIsIGZ1bmN0aW9uKCkge1xuICBpZihjdXJyZW50TW9kZSA9PSBNT0RFX0NPUFkpe1xuICAgIGxldCBzZWxlY3RlZFRleHQgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7XG4gICAgY29uc29sZS5sb2coXCJTZWxlY3RlZCBUZXh0OiBcIiArIHNlbGVjdGVkVGV4dC50b1N0cmluZygpKTtcbiAgICBzZWxlY3Rpb24gPSBzZWxlY3RlZFRleHQudG9TdHJpbmcoKTtcbiAgfVxufSk7XG5cbmNvbnN0ICR0cmFpbmluZ0J1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0cmFpbmluZ0J1dHRvbicpO1xuJHRyYWluaW5nQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICB0cmFpbmluZ01vZGUgPSAhdHJhaW5pbmdNb2RlO1xuICBpZiAodHJhaW5pbmdNb2RlKSB7XG4gICAgJHRyYWluaW5nQnV0dG9uLmlubmVySFRNTCA9IFwiQWN0aXZhdGUgVGVzdGluZ1wiO1xuICAgICRib3hIZWFkZXIuaW5uZXJIVE1MID0gXCJUUkFJTklORyBNT0RFXCI7XG4gIH0gZWxzZSB7XG4gICAgbXlSZWNvZ25pemVyLmZpdChkYXRhc2V0KTtcbiAgICAkdHJhaW5pbmdCdXR0b24uaW5uZXJIVE1MID0gXCJBY3RpdmF0ZSBUcmFpbmluZ1wiO1xuICAgICRib3hIZWFkZXIuaW5uZXJIVE1MID0gXCJURVNUSU5HIE1PREVcIjtcbiAgfVxufSk7XG4iXX0=