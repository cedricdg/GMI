'use strict';

var _draw = require('./lib/draw');

var draw = _interopRequireWildcard(_draw);

var _dataset = require('./lib/dataset');

var _dataset2 = _interopRequireDefault(_dataset);

var _recognizer = require('./lib/recognizer');

var _recognizer2 = _interopRequireDefault(_recognizer);

var _utils = require('./lib/utils');

var utils = _interopRequireWildcard(_utils);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

var letsDraw = false;
var currentGesture = [];
var gestureID = 1;
var trainingMode = true;

var $drawing = document.querySelector('#drawCan');
var $copyDialog = document.querySelector('#copyDialog');
var $copyModal = document.querySelector('#copyModal');
var $pasteModal = document.querySelector('#pasteModal');
var $pasteModalPreview = document.querySelector('#pasteModalPreview');
var $selectableText = document.querySelector('#selectableText');

var dataset = new _dataset2.default();
var myRecognizer = new _recognizer2.default();

if (typeof window.orientation !== 'undefined') {

  // start when mouse is down
  $drawing.addEventListener('touchstart', function (e) {
    e.preventDefault();
    console.log("touchstart");
    mouseDown(e);
  });

  // start when mouse is down
  $drawing.addEventListener('touchmove', function (e) {
    e.preventDefault();
    console.log("touchmove");
    mouseMove(e);
  });

  // start when mouse is down
  $drawing.addEventListener('touchend', function (e) {
    e.preventDefault();
    console.log("touchend");
    mouseUp(e);
  });

  document.addEventListener('touchend', function (e) {
    console.log("Touched text");
    console.log(e);
  });
} else {
  // start when mouse is down
  $drawing.addEventListener('mousedown', function (e) {
    console.log("mousedown");
    mouseDown(e);
  });

  // start when mouse is down
  $drawing.addEventListener('mousemove', function (e) {
    console.log("mousemove");
    mouseMove(e);
  });

  // stop when mouse is up
  $drawing.addEventListener('mouseup', function (e) {
    console.log("mouseup");
    mouseUp(e);
  });

  document.addEventListener('mouseup', function (e) {
    console.log("Touched text");
    console.log(e);
    var selectedText = window.getSelection();
    console.log(selectedText);
  });
}

var mouseDown = function mouseDown(e) {
  var coordinates = draw.getMouseXYinCanvas($drawing, e);
  draw.drawGesture($drawing, 'down', coordinates);
  currentGesture.push(coordinates);
  console.log(coordinates);
  letsDraw = true;
};

var mouseMove = function mouseMove(e) {
  if (letsDraw) {
    var coordinates = draw.getMouseXYinCanvas($drawing, e);
    draw.drawGesture($drawing, 'move', coordinates);
    currentGesture.push(coordinates);
    //console.log(coordinates);
  }
};

var mouseUp = function mouseUp(e) {
  letsDraw = false;

  currentGesture = utils.scale(currentGesture);
  currentGesture = utils.translateToOrigin(currentGesture);
  currentGesture = utils.resample(currentGesture, 30);
  // scale

  if (trainingMode) {
    dataset.addGestureWithLabel(currentGesture, gestureID);
    dataset.plotDatasetInHML();
    gestureID++;
  } else {
    var predictedLabel = myRecognizer.predict(currentGesture);
    console.log(predictedLabel);

    if (predictedLabel === 1) {
      console.log($copyModal);
      $copyModal.style.display = "none";
      $copyModal.style.display = "block";
    } else if (predictedLabel === 2) {} else {}
  }

  currentGesture = [];
};

document.addEventListener("selectionchange", function () {
  console.log('Selection changed');
  var selectedText = window.getSelection();
  console.log("text: " + selectedText);
});

var $trainingButton = document.querySelector('#trainingButton');
$trainingButton.addEventListener('click', function (e) {
  trainingMode = true;
});

var $testingButton = document.querySelector('#testingButton');
$testingButton.addEventListener('click', function (e) {
  myRecognizer.fit(dataset);
  trainingMode = false;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImRyYXciLCJ1dGlscyIsImxldHNEcmF3IiwiY3VycmVudEdlc3R1cmUiLCJnZXN0dXJlSUQiLCJ0cmFpbmluZ01vZGUiLCIkZHJhd2luZyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIiRjb3B5RGlhbG9nIiwiJGNvcHlNb2RhbCIsIiRwYXN0ZU1vZGFsIiwiJHBhc3RlTW9kYWxQcmV2aWV3IiwiJHNlbGVjdGFibGVUZXh0IiwiZGF0YXNldCIsIm15UmVjb2duaXplciIsIndpbmRvdyIsIm9yaWVudGF0aW9uIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImNvbnNvbGUiLCJsb2ciLCJtb3VzZURvd24iLCJtb3VzZU1vdmUiLCJtb3VzZVVwIiwic2VsZWN0ZWRUZXh0IiwiZ2V0U2VsZWN0aW9uIiwiY29vcmRpbmF0ZXMiLCJnZXRNb3VzZVhZaW5DYW52YXMiLCJkcmF3R2VzdHVyZSIsInB1c2giLCJzY2FsZSIsInRyYW5zbGF0ZVRvT3JpZ2luIiwicmVzYW1wbGUiLCJhZGRHZXN0dXJlV2l0aExhYmVsIiwicGxvdERhdGFzZXRJbkhNTCIsInByZWRpY3RlZExhYmVsIiwicHJlZGljdCIsInN0eWxlIiwiZGlzcGxheSIsIiR0cmFpbmluZ0J1dHRvbiIsIiR0ZXN0aW5nQnV0dG9uIiwiZml0Il0sIm1hcHBpbmdzIjoiOztBQUNBOztJQUFZQSxJOztBQUNaOzs7O0FBQ0E7Ozs7QUFDQTs7SUFBWUMsSzs7Ozs7O0FBRVosSUFBSUMsV0FBVyxLQUFmO0FBQ0EsSUFBSUMsaUJBQWlCLEVBQXJCO0FBQ0EsSUFBSUMsWUFBWSxDQUFoQjtBQUNBLElBQUlDLGVBQWUsSUFBbkI7O0FBRUEsSUFBTUMsV0FBV0MsU0FBU0MsYUFBVCxDQUF1QixVQUF2QixDQUFqQjtBQUNBLElBQU1DLGNBQWNGLFNBQVNDLGFBQVQsQ0FBdUIsYUFBdkIsQ0FBcEI7QUFDQSxJQUFNRSxhQUFhSCxTQUFTQyxhQUFULENB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LFVBQVNDLENBQVQsRUFBWTtBQUNyRGQsaUJBQWUsSUFBZjtBQUNBLENBRkQ7O0FBSUEsSUFBTXFDLGlCQUFpQm5DLFNBQVNDLGFBQVQsQ0FBdUIsZ0JBQXZCLENBQXZCO0FBQ0FrQyxlQUFleEIsZ0JBQWYsQ0FBZ0MsT0FBaEMsRUFBeUMsVUFBU0MsQ0FBVCxFQUFZO0FBQ3BESixlQUFhNEIsR0FBYixDQUFpQjdCLE9BQWpCO0FBQ0FULGlCQUFlLEtBQWY7QUFDQSxDQUhEIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQgKiBhcyBkcmF3IGZyb20gJy4vbGliL2RyYXcnXG5pbXBvcnQgRGF0YXNldCBmcm9tICcuL2xpYi9kYXRhc2V0J1xuaW1wb3J0IFJlY29nbml6ZXIgZnJvbSAnLi9saWIvcmVjb2duaXplcidcbmltcG9ydCAqIGFzIHV0aWxzIGZyb20gJy4vbGliL3V0aWxzJ1xuXG5sZXQgbGV0c0RyYXcgPSBmYWxzZTtcbmxldCBjdXJyZW50R2VzdHVyZSA9IFtdO1xubGV0IGdlc3R1cmVJRCA9IDE7XG5sZXQgdHJhaW5pbmdNb2RlID0gdHJ1ZTtcblxuY29uc3QgJGRyYXdpbmcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZHJhd0NhbicpO1xuY29uc3QgJGNvcHlEaWFsb2cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY29weURpYWxvZycpO1xuY29uc3QgJGNvcHlNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNjb3B5TW9kYWwnKTtcbmNvbnN0ICRwYXN0ZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Bhc3RlTW9kYWwnKTtcbmNvbnN0ICRwYXN0ZU1vZGFsUHJldmlldyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwYXN0ZU1vZGFsUHJldmlldycpO1xuY29uc3QgJHNlbGVjdGFibGVUZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3NlbGVjdGFibGVUZXh0Jyk7XG5cbmxldCBkYXRhc2V0ID0gbmV3IERhdGFzZXQoKTtcbmxldCBteVJlY29nbml6ZXIgPSBuZXcgUmVjb2duaXplcigpO1xuXG5pZiAodHlwZW9mIHdpbmRvdy5vcmllbnRhdGlvbiAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuICAvLyBzdGFydCB3aGVuIG1vdXNlIGlzIGRvd25cbiAgJGRyYXdpbmcuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgXHRjb25zb2xlLmxvZyhcInRvdWNoc3RhcnRcIik7XG4gICAgICBtb3VzZURvd24oZSk7XG4gIH0pO1xuXG4gIC8vIHN0YXJ0IHdoZW4gbW91c2UgaXMgZG93blxuICAkZHJhd2luZy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBmdW5jdGlvbihlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgIFx0Y29uc29sZS5sb2coXCJ0b3VjaG1vdmVcIik7XG4gICAgICBtb3VzZU1vdmUoZSk7XG4gIH0pO1xuICBcbiAgLy8gc3RhcnQgd2hlbiBtb3VzZSBpcyBkb3duXG4gICRkcmF3aW5nLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgZnVuY3Rpb24oZSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICBcdGNvbnNvbGUubG9nKFwidG91Y2hlbmRcIik7XG4gICAgICBtb3VzZVVwKGUpO1xuICB9KTtcblxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIGZ1bmN0aW9uKGUpe1xuICAgIGNvbnNvbGUubG9nKFwiVG91Y2hlZCB0ZXh0XCIpO1xuICAgIGNvbnNvbGUubG9nKGUpO1xuICB9KVxuXG59IGVsc2Uge1xuICAvLyBzdGFydCB3aGVuIG1vdXNlIGlzIGRvd25cbiAgJGRyYXdpbmcuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgZnVuY3Rpb24oZSkge1xuICAgICBcdGNvbnNvbGUubG9nKFwibW91c2Vkb3duXCIpO1xuICAgICAgbW91c2VEb3duKGUpO1xuICB9KTtcblxuICAvLyBzdGFydCB3aGVuIG1vdXNlIGlzIGRvd25cbiAgJGRyYXdpbmcuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgZnVuY3Rpb24oZSkge1xuICAgICBcdGNvbnNvbGUubG9nKFwibW91c2Vtb3ZlXCIpO1xuICAgICAgbW91c2VNb3ZlKGUpO1xuICB9KTtcblxuICAvLyBzdG9wIHdoZW4gbW91c2UgaXMgdXBcbiAgJGRyYXdpbmcuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgXHRjb25zb2xlLmxvZyhcIm1vdXNldXBcIik7XG4gICAgICBtb3VzZVVwKGUpO1xuICB9KTtcblxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZnVuY3Rpb24oZSl7XG4gICAgY29uc29sZS5sb2coXCJUb3VjaGVkIHRleHRcIik7XG4gICAgY29uc29sZS5sb2coZSk7XG4gICAgbGV0IHNlbGVjdGVkVGV4dCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTtcbiAgICBjb25zb2xlLmxvZyhzZWxlY3RlZFRleHQpO1xuICB9KVxufVxuXG5jb25zdCBtb3VzZURvd24gPSBmdW5jdGlvbihlKSB7XG4gICAgY29uc3QgY29vcmRpbmF0ZXMgPSBkcmF3LmdldE1vdXNlWFlpbkNhbnZhcygkZHJhd2luZywgZSk7XG4gICBcdGRyYXcuZHJhd0dlc3R1cmUoJGRyYXdpbmcsICdkb3duJywgY29vcmRpbmF0ZXMpO1xuICAgXHRjdXJyZW50R2VzdHVyZS5wdXNoKGNvb3JkaW5hdGVzKTtcbiAgICBjb25zb2xlLmxvZyhjb29yZGluYXRlcyk7XG4gICBcdGxldHNEcmF3ID0gdHJ1ZTtcbn07XG5cbmNvbnN0IG1vdXNlTW92ZSA9IGZ1bmN0aW9uKGUpIHtcblx0aWYgKGxldHNEcmF3KXtcbiAgICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gZHJhdy5nZXRNb3VzZVhZaW5DYW52YXMoJGRyYXdpbmcsIGUpO1xuXHQgICBcdGRyYXcuZHJhd0dlc3R1cmUoJGRyYXdpbmcsICdtb3ZlJywgY29vcmRpbmF0ZXMpO1xuXHQgICBcdGN1cnJlbnRHZXN0dXJlLnB1c2goY29vcmRpbmF0ZXMpO1xuICAgXHRcdC8vY29uc29sZS5sb2coY29vcmRpbmF0ZXMpO1xuXHQgICB9XG59O1xuXG5jb25zdCBtb3VzZVVwID0gZnVuY3Rpb24oZSkge1xuICAgXHRsZXRzRHJhdyA9IGZhbHNlO1xuXG4gICAgY3VycmVudEdlc3R1cmUgPSB1dGlscy5zY2FsZShjdXJyZW50R2VzdHVyZSk7XG4gICAgY3VycmVudEdlc3R1cmUgPSB1dGlscy50cmFuc2xhdGVUb09yaWdpbihjdXJyZW50R2VzdHVyZSk7XG4gICAgY3VycmVudEdlc3R1cmUgPSB1dGlscy5yZXNhbXBsZShjdXJyZW50R2VzdHVyZSwgMzApO1xuICAgIC8vIHNjYWxlXG5cbiAgICBpZih0cmFpbmluZ01vZGUpe1xuXHRcdFx0ZGF0YXNldC5hZGRHZXN0dXJlV2l0aExhYmVsKGN1cnJlbnRHZXN0dXJlLCBnZXN0dXJlSUQpO1xuICAgXHRcdGRhdGFzZXQucGxvdERhdGFzZXRJbkhNTCgpO1xuXHRcdFx0Z2VzdHVyZUlEKys7XG5cdFx0fSBlbHNle1xuXHRcdFx0Y29uc3QgcHJlZGljdGVkTGFiZWwgPSBteVJlY29nbml6ZXIucHJlZGljdChjdXJyZW50R2VzdHVyZSk7XG5cdFx0XHRjb25zb2xlLmxvZyhwcmVkaWN0ZWRMYWJlbCk7XG5cbiAgICAgIGlmKHByZWRpY3RlZExhYmVsID09PSAxKVxuICAgICAge1xuICAgICAgICBjb25zb2xlLmxvZygkY29weU1vZGFsKTtcbiAgICAgICAgJGNvcHlNb2RhbC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICRjb3B5TW9kYWwuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgIH0gZWxzZSBpZihwcmVkaWN0ZWRMYWJlbCA9PT0gMil7XG5cbiAgICAgIH0gZWxzZSB7XG5cbiAgICAgIH1cblx0XHR9XG5cblx0ICAgXHRjdXJyZW50R2VzdHVyZSA9IFtdO1xufTtcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInNlbGVjdGlvbmNoYW5nZVwiLCBmdW5jdGlvbigpIHtcbiAgY29uc29sZS5sb2coJ1NlbGVjdGlvbiBjaGFuZ2VkJyk7XG4gIGxldCBzZWxlY3RlZFRleHQgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7XG4gIGNvbnNvbGUubG9nKFwidGV4dDogXCIgKyBzZWxlY3RlZFRleHQpO1xufSk7XG5cbmNvbnN0ICR0cmFpbmluZ0J1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0cmFpbmluZ0J1dHRvbicpO1xuJHRyYWluaW5nQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuXHR0cmFpbmluZ01vZGUgPSB0cnVlO1xufSk7XG5cbmNvbnN0ICR0ZXN0aW5nQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Rlc3RpbmdCdXR0b24nKTtcbiR0ZXN0aW5nQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuXHRteVJlY29nbml6ZXIuZml0KGRhdGFzZXQpO1xuXHR0cmFpbmluZ01vZGUgPSBmYWxzZTtcbn0pO1xuIl19